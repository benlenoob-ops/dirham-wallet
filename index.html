<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dirham Wallet</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Bienvenue sur Dirham Wallet</h1>
    </header>

    <main>
        <button id="add-dirhams">Ajouter des dirhams</button>
        <button id="withdraw-dirhams">Retirer des dirhams</button>
        <div id="user-list"></div>
        <div>
            <label for="amount">Montant à envoyer :</label>
            <input type="number" id="amount" placeholder="Montant en dirhams">
            <button id="send-dirhams">Envoyer</button>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Dirham Wallet. Tous droits réservés.</p>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js"></script>

    <script>
        // Remplacez ces valeurs par celles obtenues dans la console Firebase
        const firebaseConfig = {
            apiKey: "AlzaSyBp-Wr27trteEBYhME-FPmgoy5_ub8hN0Q", 
            authDomain: "dirhams-f50cf.firebaseapp.com", 
            databaseURL: "https://dirhams-f50cf-default-rtdb.firebaseio.com", 
            projectId: "dirhams-f50cf", 
            storageBucket: "dirhams-f50cf.appspot.com", 
            messagingSenderId: "737493283081", 
            appId: "1:737493283081:web:f97f72b06f3a21cd45c5c4", 
            measurementId: "G-MF9G7N0PC6" 
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // Fonction pour ajouter des dirhams
        document.getElementById('add-dirhams').addEventListener('click', function() {
            const user = auth.currentUser;
            if (user) {
                const dirhamsToAdd = prompt("Combien de dirhams voulez-vous ajouter ?");
                if (dirhamsToAdd && !isNaN(dirhamsToAdd)) {
                    const userRef = database.ref('users/' + user.uid);
                    userRef.once('value', function(snapshot) {
                        const currentDirhams = snapshot.val()?.dirhams || 0;
                        const newDirhams = currentDirhams + parseInt(dirhamsToAdd);
                        userRef.update({ dirhams: newDirhams });
                        alert("Vous avez ajouté " + dirhamsToAdd + " dirhams !");
                    });
                } else {
                    alert("Veuillez entrer un nombre valide.");
                }
            } else {
                alert("Veuillez vous connecter d'abord.");
            }
        });

        // Fonction pour retirer des dirhams
        document.getElementById('withdraw-dirhams').addEventListener('click', function() {
            const user = auth.currentUser;
            if (user) {
                const dirhamsToWithdraw = prompt("Combien de dirhams voulez-vous retirer ?");
                if (dirhamsToWithdraw && !isNaN(dirhamsToWithdraw)) {
                    const userRef = database.ref('users/' + user.uid);
                    userRef.once('value', function(snapshot) {
                        const currentDirhams = snapshot.val()?.dirhams || 0;
                        if (currentDirhams >= dirhamsToWithdraw) {
                            const newDirhams = currentDirhams - parseInt(dirhamsToWithdraw);
                            userRef.update({ dirhams: newDirhams });
                            alert("Vous avez retiré " + dirhamsToWithdraw + " dirhams !");
                        } else {
                            alert("Vous n'avez pas assez de dirhams.");
                        }
                    });
                } else {
                    alert("Veuillez entrer un nombre valide.");
                }
            } else {
                alert("Veuillez vous connecter d'abord.");
            }
        });

        // Fonction pour envoyer des dirhams
        document.getElementById('send-dirhams').addEventListener('click', function() {
            const recipientEmail = prompt("Entrez l'email du destinataire :");
            const amount = document.getElementById('amount').value;
            if (recipientEmail && amount && !isNaN(amount)) {
                const sender = auth.currentUser;
                if (sender) {
                    const senderRef = database.ref('users/' + sender.uid);
                    senderRef.once('value', function(snapshot) {
                        const senderDirhams = snapshot.val()?.dirhams || 0;
                        if (senderDirhams >= amount) {
                            const recipientRef = database.ref('users').orderByChild('email').equalTo(recipientEmail);
                            recipientRef.once('value', function(recipientSnapshot) {
                                if (recipientSnapshot.exists()) {
                                    const recipientUid = Object.keys(recipientSnapshot.val())[0];
                                    const recipientDirhams = recipientSnapshot.val()[recipientUid].dirhams || 0;
                                    senderRef.update({ dirhams: senderDirhams - amount });
                                    database.ref('users/' + recipientUid).update({ dirhams: recipientDirhams + parseInt(amount) });
                                    alert("Vous avez envoyé " + amount + " dirhams à " + recipientEmail);
                                } else {
                                    alert("Utilisateur non trouvé.");
                                }
                            });
                        } else {
                            alert("Vous n'avez pas assez de dirhams.");
                        }
                    });
                } else {
                    alert("Veuillez vous connecter d'abord.");
                }
            } else {
                alert("Veuillez entrer un email et un montant valides.");
            }
        });
    </script>
</body>
</html>
